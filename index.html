<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>To-Do List</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-5">
<h1>To-Do List</h1>

<form id="taskForm" class="mb-3">
    <input type="text" id="title" placeholder="Titolo" class="form-control mb-1" required>
    <input type="text" id="description" placeholder="Descrizione" class="form-control mb-1" required>
    <button class="btn btn-primary">Aggiungi Task</button>
</form>

<ul id="tasks" class="list-group"></ul>

<script>
const apiUrl = 'http://localhost:5150/api/tasks';


async function fetchTasks() {
    const res = await fetch(apiUrl);
    const tasks = await res.json();
    const ul = document.getElementById('tasks');
    ul.innerHTML = '';
    tasks.forEach(t => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.textContent = `${t.title} - ${t.description} ${t.isCompleted ? '(Completato)' : ''}`;
        const btn = document.createElement('button');
        btn.textContent = 'Toggle';
        btn.className = 'btn btn-sm btn-success ms-2';
        btn.onclick = async () => { await fetch(`${apiUrl}/${t.id}/toggle`, {method: 'PATCH'}); fetchTasks(); };
        li.appendChild(btn);
        ul.appendChild(li);
    });
}

document.getElementById('taskForm').onsubmit = async e => {
    e.preventDefault();
    const title = document.getElementById('title').value;
    const description = document.getElementById('description').value;
    await fetch(apiUrl, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({title, description})
    });
    document.getElementById('title').value = '';
    document.getElementById('description').value = '';
    fetchTasks();
};

fetchTasks();
</script>
</body>
</html>
